<!DOCTYPE html>
<html>
    <head>
        <script src="{{ static_url('js/jquery-1.8.0.min.js') }}"></script>
        
        <script type="text/javascript">
            var ws = new WebSocket("ws://localhost:8000/chat");
            ws.onmessage = function(event) {
                //console.log(event);
                var msg = JSON.parse(event.data)["message"]
                var users_list = JSON.parse(event.data)["users_list"]

                if(msg != undefined){
                    $('#msgBox').append("<p>"+JSON.parse(event.data)["message"]+"</p>");
                }

                if(users_list != undefined){
                    $('#userList').empty();
                    $.each(users_list, function(i, item){
                        $('#userList').append("<div>");
                        $('#userList').append("<p>"+item.nickName+"</p>");
                        $('#userList').append("<input type='hidden' id='users_"+i+"' value='"+item.serial+"'>");
                    })
                }

                //滚动条自动向下
                var e = document.getElementById("msgBox");
                e.scrollTop = e.scrollHeight;
            }
            function send1() {
                //如果要向某个客户端发送消息：某个客户端的id`内容
                //TODO
                //ws.send('{"msg": '+$("#chat").val()+', "flag": "123"}');
                ws.send($("#chat").val());
                $("#chat").val("");
            }
        </script>
        
        <style type="text/css">
            #userList p{margin: 5px 0 5px 0;}
            #msgBox p{margin: 5px 0 5px 0;}
        </style>
    </head>

    <body>
        <div id="userList" style="width: 200px; height: 300px; border: 1px solid #000000; overflow: auto; float: left;">

        </div>
        
        <div style="float: left; padding-left: 20px;">
	        <div id="msgBox" style="width:400px;height:300px;border:1px solid #000000;overflow: auto;"></div>
	        <div>
	            hello
	            <input id="chat">
	            <button  onclick="send1()">send</button>
	        </div>	
        </div>

        <div>
            <a href="/logout">退出</a>
        </div>
    </body>
</html>